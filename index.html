<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Negócios de Família</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <style>
        body {
            background-image: url('bkg.jpg');
            background-size: cover;
            background-repeat: repeat;
            background-attachment: fixed;
        }

        .custom-cell {
            height: 400px;
            width: 30px;
        }

        .custo2 {
            height: 30px;
            width: 30px;
        }

        .bg-abobora {
            background-color: orange !important;
        }

        .bg-alho {
            background-color: lightgray !important;
        }

        .bg-batata {
            background-color: darkgoldenrod !important;
        }

        .bg-cenoura {
            background-color: darkorange !important;
        }

        .bg-morango {
            background-color: red !important;
        }

        .bg-pimentao {
            background-color: green !important;
        }

        .bg-repolho {
            background-color: lightgreen !important;
        }

        .bg-tomate {
            background-color: tomato !important;
        }

        .bg-afeta {
            background-color: rgb(70, 44, 21) !important;
        }

        .bg-nao-afeta {
            background-color: lightgreen !important;
        }

        .bg-praga {
            background-color: lightcoral !important;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="./logo.png" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
                Negócios de Família
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-link active" aria-current="page" href="./index.html">Home</a>
                    <a class="nav-link" href="./regras.html">Regras</a>
                </div>
            </div>
        </div>
    </nav>
    <div class="container container-fluid bg-white bg-opacity-75">
        <div class="container mt-5">
            <h1>Seleção de Culturas</h1>
            <table class="table table-bordered">
                <tbody>
                    <!-- Linha 1 -->
                    <tr>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura1" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura2" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura3" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura4" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura5" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura6" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura7" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura8" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura9" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                        <td class="custom-cell align-middle">
                            <select class="form-select" id="cultura10" onchange="checkSelection(this)">
                                <option value="Ab_c">Abóbora convencional</option>
                                <option value="Ab_o">Abóbora orgânica</option>
                                <option value="Al_c">Alho convencional</option>
                                <option value="Al_o">Alho orgânico</option>
                                <option value="Ba_c">Batata convencional</option>
                                <option value="Ba_o">Batata orgânica</option>
                                <option value="Ce_c">Cenoura convencional</option>
                                <option value="Ce_o">Cenoura orgânica</option>
                                <option value="Mo_c">Morango convencional</option>
                                <option value="Mo_o">Morango orgânico</option>
                                <option value="Pi_c">Pimentão convencional</option>
                                <option value="Pi_o">Pimentão orgânico</option>
                                <option value="Re_c">Repolho convencional</option>
                                <option value="Re_o">Repolho orgânico</option>
                                <option value="To_c">Tomate convencional</option>
                                <option value="To_o">Tomate orgânico</option>
                            </select>
                        </td>
                    </tr>
                    <!-- Linha 2 -->
                    <tr>
                        <td class="custom2 align-middle bg-praga" id="praga1"></td>
                        <td class="custom2 align-middle bg-praga" id="praga2"></td>
                        <td class="custom2 align-middle bg-praga" id="praga3"></td>
                        <td class="custom2 align-middle bg-praga" id="praga4"></td>
                        <td class="custom2 align-middle bg-praga" id="praga5"></td>
                        <td class="custom2 align-middle bg-praga" id="praga6"></td>
                        <td class="custom2 align-middle bg-praga" id="praga7"></td>
                        <td class="custom2 align-middle bg-praga" id="praga8"></td>
                        <td class="custom2 align-middle bg-praga" id="praga9"></td>
                        <td class="custom2 align-middle bg-praga" id="praga10"></td>
                    </tr>
                </tbody>
            </table>
            <h4>LUCRO: <i id="lucro">R$0.00</i></h4>
            <h4>CULTURAS: <i id="qtd_culturas">0</i></h4>
            <h4>ORGÂNICOS: <i id="qtd_organicos">0</i></h4>
            <button class="btn btn-primary" onclick="checkLucro()">Calcular Pontuação</button>
            <button class="btn btn-danger" onclick="lancarPragas()">Lançar Pragas</button>
        </div>
    </div>

    <script>
        function lancarPragas() {
            let c = [];
            let lucro = [];
            let culturasSet = new Set();
            let organicosSet = new Set();
            const pragas = ["Tempo", "Pulgão", "Mosca branca", "Ácaro rajado", "Tripes"];

            // Mapa de pragas e suas culturas afetadas
            const pragaCulturaAfetada = {
                "Tempo": ["Ab", "Al", "Ba", "Ce", "Mo", "Pi", "Re", "To"],
                "Pulgão": ["Ab", "Al", "Ba", "Ce", "Mo", "Pi", "Re", "To"],
                "Mosca branca": ["Re", "Ba", "Ce"],
                "Ácaro rajado": ["Mo", "Pi", "Ab"],
                "Tripes": ["To", "Al"]
            };

            for (let i = 1; i <= 10; i++) {
                c[i - 1] = document.getElementById(`cultura${i}`).value;
                let culturaBase = c[i - 1].slice(0, 2); // Normaliza a cultura removendo o sufixo
                culturasSet.add(culturaBase); // Adiciona a cultura ao Set (duplicações são automaticamente ignoradas)

                if (c[i - 1].endsWith('_o')) {
                    organicosSet.add(culturaBase); // Adiciona a cultura orgânica normalizada ao Set (duplicações são automaticamente ignoradas)
                }

                const selectElement = document.getElementById(`cultura${i}`);
                const pragaSorteada = pragas[Math.floor(Math.random() * pragas.length)];

                // Exibe a praga sorteada na célula correspondente
                document.getElementById(`praga${i}`).innerText = pragaSorteada;

                // Remove as classes de fundo existentes
                selectElement.parentNode.classList.remove('bg-afeta');
                selectElement.parentNode.classList.remove('bg-nao-afeta');

                // Verifica se a praga sorteada afeta a cultura selecionada
                const afetaCultura = pragaCulturaAfetada[pragaSorteada] && pragaCulturaAfetada[pragaSorteada].includes(culturaBase);

                // Aplica a cor de fundo vermelha caso a praga afete a cultura
                if (afetaCultura) {
                    selectElement.parentNode.classList.add('bg-afeta');
                }
            }
        }

        function checkSelection(selectElement) {
            const colorMap = {
                'Abóbora': 'bg-abobora',
                'Alho': 'bg-alho',
                'Batata': 'bg-batata',
                'Cenoura': 'bg-cenoura',
                'Morango': 'bg-morango',
                'Pimentão': 'bg-pimentao',
                'Repolho': 'bg-repolho',
                'Tomate': 'bg-tomate'
            };

            const selectedText = selectElement.options[selectElement.selectedIndex].text;
            const cell = selectElement.parentElement;

            // Remove todas as classes de fundo
            for (const key in colorMap) {
                cell.classList.remove(colorMap[key]);
            }

            // Adiciona a classe correspondente à seleção
            for (const key in colorMap) {
                if (selectedText.includes(key)) {
                    cell.classList.add(colorMap[key]);
                }
            }
        }

        function checkLucro() {
            let soma = 0;
            let c = [];
            let lucro = [];
            let culturasSet = new Set();
            let organicosSet = new Set();

            for (let i = 0; i < 10; i++) {
                c[i] = document.getElementById(`cultura${i + 1}`).value;
                let culturaBase = c[i].slice(0, 2); // Normaliza a cultura removendo o sufixo
                culturasSet.add(culturaBase); // Adiciona a cultura ao Set (duplicações são automaticamente ignoradas)

                if (c[i].endsWith('_o')) {
                    organicosSet.add(culturaBase); // Adiciona a cultura orgânica normalizada ao Set (duplicações são automaticamente ignoradas)
                }
            }

            const lucroMap = {
                "Ab_c": -242.50,
                "Ab_o": 2042.86,
                "Al_c": 5823.95,
                "Al_o": 21820.32,
                "Ba_c": 1599.80,
                "Ba_o": 17404.46,
                "Ce_c": 988.28,
                "Ce_o": -1878.05,
                "Mo_c": 95309.20,
                "Mo_o": 108062.50,
                "Pi_c": -2696.00,
                "Pi_o": 5099.84,
                "Re_c": 505.62,
                "Re_o": 14349.18,
                "To_c": 13555.60,
                "To_o": 32608.92
            };

            for (let i = 0; i < 10; i++) {
                lucro[i] = lucroMap[c[i]] || 0; // Se a cultura não for encontrada, defina o lucro como 0
            }

            for (let i = 0; i < 10; i++) {
                const praga = document.getElementById(`praga${i + 1}`).innerText;
                const prejuizo = calcularPrejuizo(c[i], praga);
                lucro[i] -= lucro[i] * prejuizo; // Aplica o prejuízo ao lucro
                soma += lucro[i];
            }

            const formattedSoma = soma.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            const qtdCulturas = culturasSet.size; // Tamanho do Set representa a quantidade de culturas únicas
            const qtdOrganicos = organicosSet.size; // Tamanho do Set representa a quantidade de culturas orgânicas únicas

            document.getElementById("lucro").innerHTML = formattedSoma;
            document.getElementById("qtd_culturas").innerHTML = qtdCulturas;
            document.getElementById("qtd_organicos").innerHTML = qtdOrganicos;
        }

        function calcularPrejuizo(cultura, praga) {
            const culturaBase = cultura.slice(0, 2); // Normaliza a cultura removendo o sufixo
            const isOrganica = cultura.endsWith('_o');
            let prejuizo = 0;

            const pragasConvencionais = ["Mosca branca", "Ácaro rajado", "Tripes"];
            const pragasUniversais = ["Tempo", "Pulgão"];

            if (pragasConvencionais.includes(praga)) {
                if (isOrganica) {
                    prejuizo = 1.0; // 100% prejuízo
                } else {
                    prejuizo = 0.5; // 50% prejuízo
                }
            } else if (pragasUniversais.includes(praga)) {
                if (isOrganica) {
                    prejuizo = 0.5; // 50% prejuízo
                } else {
                    prejuizo = 1.0; // 100% prejuízo
                }
            }

            const pragaCulturaAfetada = {
                "Tempo": ["Ab", "Al", "Ba", "Ce", "Mo", "Pi", "Re", "To"],
                "Pulgão": ["Ab", "Al", "Ba", "Ce", "Mo", "Pi", "Re", "To"],
                "Mosca branca": ["Re", "Ba", "Ce"],
                "Ácaro rajado": ["Mo", "Pi", "Ab"],
                "Tripes": ["To", "Al"]
            };

            if (pragaCulturaAfetada[praga] && pragaCulturaAfetada[praga].includes(culturaBase)) {
                return prejuizo;
            }

            return 0; // Se a praga não afeta a cultura, não há prejuízo
        }

    </script>
</body>

</html>